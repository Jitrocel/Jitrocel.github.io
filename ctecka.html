<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>QR Code Reader</title>
</head>
<body>
  <script src="https://cdn.jsdelivr.net/npm/jsqr@1.0.0/dist/jsQR.js"></script>
  <script>
    async function readQRCode() {
      try {
        const video = document.createElement('video');
        const constraints = { video: true };
        const stream = await navigator.mediaDevices.getUserMedia(constraints);
        video.srcObject = stream;

        await video.play();

        const canvas = document.createElement('canvas');
        const context = canvas.getContext('2d');
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;

        const geojsonURL = 'KHK_rozhledny.geojson'; // Změňte na odpovídající cestu ke svému souboru GeoJSON

        const response = await fetch(geojsonURL);
        const geojsonData = await response.json();

        const qrCode = await new Promise((resolve) => {
          const onFrame = () => {
            context.drawImage(video, 0, 0, canvas.width, canvas.height);
            const imageData = context.getImageData(0, 0, canvas.width, canvas.height);
            const code = jsQR(imageData.data, imageData.width, imageData.height);

            if (code) {
              resolve(code.data);
            } else {
              requestAnimationFrame(onFrame);
            }
          };

          onFrame();
        });

        stream.getTracks().forEach(track => track.stop());

        // Porovnání s GeoJSON souřadnicemi
        const foundFeature = geojsonData.features.find(feature => feature.properties.coordinates === qrCode);

        alert(qrCode);
        alert()
        
        if (foundFeature) {
          alert('úspěch');
          const souradnice = foundFeature.geometry.coordinates;
          console.log('Souradnice:', souradnice);
        } else {
          alert('QR kód nebyl nalezen v GeoJSON souboru.');
        }
      } catch (error) {
        console.error('Chyba:', error);
      }
    }

    readQRCode();
  </script>
</body>
</html>
